<?xml version="1.0" encoding="UTF-8"?>

<!--
B86-ZK-3940.zul

	Purpose:
		
	Description:
		
	History:
		Fri Aug 27 14:14:20 CST 2018, Created by wenninghsu

Copyright (C) 2018 Potix Corporation. All Rights Reserved.

-->
<zk xmlns:w="client">
    <label multiline="true">
        In Tomcat
        1. Click button '7500', should see 'true' in zklog.
        2. Click button '8100', should see 'true' in zklog.

        In Jetty
        1. Click button '65000', should see 'true' in zklog.
        1. Click button '66000', should see 'true' in zklog.

        In any server
        Click button 'rare words', should see 'true' in zklog.
        (true means the sent and received messages are the same)

    </label>
    <script>
        var data,
            originalMsgBufferedSize;

        function fireData ({ size }) {
            if (originalMsgBufferedSize == undefined)
                originalMsgBufferedSize = zWs._maxTextMessageBufferSize;
            zWs._maxTextMessageBufferSize = originalMsgBufferedSize;
            data = 'a'.repeat(size);
            zk.$('$comp').fire('onData', {text: data}, {toServer: true});
        }

        function testOthers() {
            if (originalMsgBufferedSize == undefined)
                originalMsgBufferedSize = zWs._maxTextMessageBufferSize;
            zWs._maxTextMessageBufferSize = 176; // bytes length to the first ğ¬¶¨ is 178, and it's a three bytes character, so 176 could see if it's splitting well
            data = 'ã«ã£ã½ã‚“ã”â¤â˜€â˜»/ã«ã»ã‚“ã”ğŸ˜†ğ¬¶¨bbğ¬¶¨adğ¬¶¨ğ¬¶¨â‚¬gğ¬¶¨à¸ªà¸šà¸²à¸¢à¸”à¸µà¸«à¸£à¸·à¸­?æˆ–à¸ªà¸šâ˜†â˜‚à¸²à¸¢à¸”à¸µà¹„à¸«à¸¡?qğ¬¶¨hhtğ¬¶¨wewĞ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²â™ÑƒĞ¹(Ñ‚Ğµ)!ewewìš°ë¦¬ê°€ì¡±ì€ëª¨â˜­â†’ë‘ë„·ì´ì—ìš”.ì•„ë²„ì§€ì™€ì–´ë¨¸ë‹ˆê°€ê³„ì‹œê³ ì €ì™€ë™ìƒˆâ˜¯ì´ìˆâ˜¢ì–´ìš”.ewe';
            zk.$('$comp').fire('onData', {text: data}, {toServer: true});
        }

        function assertEqual(receivedData) {
            zk.log(data == receivedData);
        }

    </script>
    <div id="comp">
        <attribute name="onData">
            String text = event.getData().get("text");
            Clients.evalJavaScript("assertEqual('" + text + "')");
        </attribute>
    </div>
    For Tomcat:
    <button label="7500" w:onClick="fireData({size: +this._label})"/>
    <button label="8100" w:onClick="fireData({size: +this._label})" style="background-color: red;"/>
    <separator/>
    For Jetty:
    <button label="65000" w:onClick="fireData({size: +this._label})"/>
    <button label="66000" w:onClick="fireData({size: +this._label})" style="background-color: red;"/>
    <separator/>
    <button label="rare words" w:onClick="testOthers()" style="background-color: green;"/>
</zk>
